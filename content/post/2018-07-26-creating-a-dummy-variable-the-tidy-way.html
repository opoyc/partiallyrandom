---
title: 'Creating a dummy variable: the Tidy way'
author: Obryan Poyser
date: '2018-07-26'
slug: creating-a-dummy-variable-the-tidy-way
categories:
  - R Language
tags:
  - categorical variable
type: post
description: ""
keywords:
  - key
  - words
topics:
  - topic 1
---

<script src="/rmarkdown-libs/htmlwidgets/htmlwidgets.js"></script>
<script src="/rmarkdown-libs/jquery/jquery.min.js"></script>
<link href="/rmarkdown-libs/datatables-css/datatables-crosstalk.css" rel="stylesheet" />
<script src="/rmarkdown-libs/datatables-binding/datatables.js"></script>
<link href="/rmarkdown-libs/dt-core/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="/rmarkdown-libs/dt-core/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="/rmarkdown-libs/dt-core/js/jquery.dataTables.min.js"></script>
<link href="/rmarkdown-libs/crosstalk/css/crosstalk.css" rel="stylesheet" />
<script src="/rmarkdown-libs/crosstalk/js/crosstalk.min.js"></script>


<p>Working with categorical variables in R can be a headache sometimes. Among the things I miss the most in Stata is how easy is to convert categorical variables to dummy/binary variables which are used to compare categorical variables in a regression. For instance, converting the variable result composed by a Likert scale of order 3 (bad, good and excellent). In Stata you just type tabulate result, generate(res) as seen below:</p>
<pre><code>tabulate result, generate(res)

          result |      Freq.     Percent        Cum.
 ----------------+-----------------------------------
             bad |          2       40.00       40.00
       excellent |          1       20.00       60.00
            good |          2       40.00      100.00
 ----------------+-----------------------------------
           Total |          5      100.00
</code></pre>
<p>The result will be:</p>
<pre><code>describe

 Contains data
   obs:             5                          
  vars:             4                          
  size:           110 (99.9% of memory free)
 ------------------------------------------------------------------------
               storage  display     value
 variable name   type   format      label      variable label
 ------------------------------------------------------------------------
 result          str15  %15s                   
 res1            byte   %8.0g                  result==bad
 res2            byte   %8.0g                  result==excellent
 res3            byte   %8.0g                  result==good
 ------------------------------------------------------------------------
 Sorted by:  
      Note:  dataset has changed since last saved
 
list

      +--------------------------------+
      |    result   res1   res2   res3 |
      |--------------------------------|
   1. |      good      0      0      1 |
   2. |       bad      1      0      0 |
   3. |      good      0      0      1 |
   4. | excellent      0      1      0 |
   5. |       bad      1      0      0 |
      +--------------------------------+</code></pre>
<p>As you can note the are 3 new variables res1, res2, and res3. Easy isn’t? Well, in R I haven’t found yet an easy way to emulate the process. Recently I had to “tidy” a survey that I’ve collected on the Internet, in it, some variables were of the type “multiple choice”, particularly every option (category) was identified by a number. Below you can find an example:</p>
<pre class="r"><code>db &lt;- data.frame(mult_choice1=c(&quot;1,2&quot;, &quot;2,4,6&quot;, &quot;5,6&quot;), age=c(23, 30, 18), education=c(&quot;primary&quot;, &quot;secondary&quot;, &quot;tertiary&quot;))
db %&gt;%
    DT::datatable()</code></pre>
<div id="htmlwidget-1" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-1">{"x":{"filter":"none","data":[["1","2","3"],["1,2","2,4,6","5,6"],[23,30,18],["primary","secondary","tertiary"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>mult_choice1<\/th>\n      <th>age<\/th>\n      <th>education<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":2},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p>What I needed was to convert option=1 to a dummy variable that could be bound to the original data frame. In order to solve this problem I created the code below:</p>
<pre class="r"><code>tocolF &lt;- function(df, var, sep=&quot;,&quot;, names=NULL){
    if(!require(tidyverse)){
        install.packages(&quot;tidyverse&quot;)
        require(tidyverse)
        }
    if(!require(janitor)){
        install.packages(&quot;janitor&quot;)
        require(janitor)
            }
    varname &lt;- deparse(substitute(var))
    unique &lt;- df %&gt;%
        .[var] %&gt;%
        .[[1]] %&gt;%
        stringr::str_split(pattern = sep) %&gt;%
        unlist() %&gt;%
        unique()
    if(is.null(names)==F){
        lab0 &lt;- names %&gt;%
            as.data.frame() %&gt;%
            tibble::rownames_to_column() %&gt;%
            set_names(c(&quot;rowname&quot;, &quot;value&quot;))
        lab1 &lt;- unique %&gt;%
            as.tibble() %&gt;%
            left_join(lab0, by=&quot;value&quot;)
    } else {
        message(&quot;Unique categories are going to be used&quot;)
    }
    
    if(is.null(names)==T){
        purrr::map(unique, function(x) {
            stringr::str_detect(string = df[var] %&gt;%
                                    .[[1]], pattern = paste0(&quot;(?:^|\\W)&quot;, x, &quot;(?:$|\\W)&quot;)) %&gt;%
                as.numeric()
        }) %&gt;%
            bind_cols() %&gt;%
            set_names(paste0(varname,&quot;_&quot;, unique)) %&gt;%
            janitor::clean_names()
    } else {
        purrr::map(lab1$value, function(x) {
            stringr::str_detect(string = df[var] %&gt;%
                                    .[[1]], pattern = paste0(&quot;(?:^|\\W)&quot;, x, &quot;(?:$|\\W)&quot;)) %&gt;%
                as.numeric()
        }) %&gt;%
            bind_cols() %&gt;%
            set_names(paste0(varname,&quot;_&quot;, lab1$rowname)) %&gt;%
            janitor::clean_names()
    }
}</code></pre>
<p>The process to convert individual choices to binary variables is done by a <em>tidy</em> form:</p>
<pre class="r"><code>db %&gt;%
    bind_cols(tocolF(., &quot;mult_choice1&quot;)) %&gt;%
    DT::datatable()</code></pre>
<div id="htmlwidget-2" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-2">{"x":{"filter":"none","data":[["1","2","3"],["1,2","2,4,6","5,6"],[23,30,18],["primary","secondary","tertiary"],[1,0,0],[1,1,0],[0,1,0],[0,1,1],[0,0,1]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>mult_choice1<\/th>\n      <th>age<\/th>\n      <th>education<\/th>\n      <th>mult_choice1_1<\/th>\n      <th>mult_choice1_2<\/th>\n      <th>mult_choice1_4<\/th>\n      <th>mult_choice1_6<\/th>\n      <th>mult_choice1_5<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,4,5,6,7,8]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p>It works also with single category variable such as <code>education</code></p>
<pre class="r"><code>db %&gt;%
    bind_cols(tocolF(., &quot;education&quot;)) %&gt;%
    DT::datatable()</code></pre>
<div id="htmlwidget-3" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-3">{"x":{"filter":"none","data":[["1","2","3"],["1,2","2,4,6","5,6"],[23,30,18],["primary","secondary","tertiary"],[1,0,0],[0,1,0],[0,0,1]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>mult_choice1<\/th>\n      <th>age<\/th>\n      <th>education<\/th>\n      <th>education_primary<\/th>\n      <th>education_secondary<\/th>\n      <th>education_tertiary<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[2,4,5,6]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p>Voilà! Happy tidying! :D</p>
